function Card(e,i){var t=this;return this.data=i,this.id=e,this.el=$('.card-item[data-id="'+this.id+'"]'),this.size="medium",this.infoTemplateSource=$("#info-template").html(),this.infoTemplate=Handlebars.compile(this.infoTemplateSource),this.init=function(){this.initEvents()},this.initEvents=function(){events.subscribe("filter.update",this.filter),events.subscribe("sort.update",this.sort),events.subscribe("size.update",this.size),this.el.on("mouseenter",this.loadGifs),this.el.find(".has-media").on("mouseenter",this.showMedia),this.el.find(".has-media").on("tap",this.showMedia),this.el.find(".has-media").on("mouseleave",this.hideMedia),this.el.on("click",".toggle-card",this.toggleCard)},this.toggleCard=function(e){t.el.toggleClass("expanded-card"),$("body").removeClass("small medium large"),t.el.hasClass("expanded-card")?$("body").addClass("large"):$("body").addClass(t.size)},this.showMedia=function(){var e=$(this).data("media");$('.plus-minus-media[data-id="'+e+'"]').css("background-image");$(this).addClass("color-theme"),$(".player-stat-image").addClass("media-shown"),$('.plus-minus-media[data-id="'+e+'"]').addClass("visible"),$('.plus-minus-media[data-id="'+e+'"] img').attr("src",""),$('.plus-minus-media[data-id="'+e+'"] img').attr("src",e)},this.hideMedia=function(){var e=$(this).data("media");$(this).removeClass("color-theme"),$(".player-stat-image").removeClass("media-shown"),$('.plus-minus-media[data-id="'+e+'"]').removeClass("visible")},this.loadGifs=function(){t.loaded||(t.loaded=!0,_.each(t.el.find(".plus-minus-media"),function(e){var i=$(e).find("img");i.attr("src",i.data("src"))}))},this.filter=function(e){"all"===e.filter||t.data.position_group.toLowerCase()===e.filter?t.el.removeClass("unfiltered"):t.el.addClass("unfiltered"),t.el.addClass("sort"),setTimeout(function(){t.el.removeClass("sort")},500)},this.sort=function(){},this.size=function(e){t.size=e.size},this.update=function(e){this.data=e,this.loaded=!1;var i=$("body").hasClass("mobile")?2e3:1500;setTimeout(function(){$(t.el).find(".info-column").html(t.infoTemplate(t.data))},i)},this.init(),t}function CardList(){var e=this;return this.$el=$("#item-list"),this.templateSource=$("#player-card-template").html(),this.template=Handlebars.compile(this.templateSource),this.coverageTemplateSource=$("#coverage-template").html(),this.coverage_template=Handlebars.compile(this.coverageTemplateSource),this.cards=[],this.sort_id=GLOBALS.current_sort,this.filter_id="all",this.initial_player=GLOBALS.player||!1,this.filterOffsetPos=$("#content").offset().top,this.size="medium",this.cards=[],this.init=function(){this.initEvents(),this.scrollWatch(),this.initial_player&&e.openPlayer(),this.initCards()},this.initCards=function(){var i,t=0;_.each(GLOBALS.list[e.sort_id],function(s,a){var o=s.filter_id;s=_.findWhere(GLOBALS.data.players,{filter_id:o}),s?(t++,i=new Card(t,s),e.cards.push(i)):console.log("missing player",o)})},this.initEvents=function(){$("#filters a").on("click",this.filter),$("#filter-bar").on("click","a",this.sort),$(".size-toggle").on("click","li",this.changeSize),$(".size-toggle").on("mouseenter","li",this.previewSize),$(".size-toggle").on("mouseleave","li",this.revertSize),$(window).on("resize",this.windowResize),GLOBALS.player||$(window).on("scroll",e.scrollWatch)},this.previewSize=function(){e.size_preview=$(this).data("size"),$(".size-indicator").attr("class","size-indicator").addClass(e.size_preview)},this.revertSize=function(){$(".size-indicator").attr("class","size-indicator").addClass(e.size)},this.windowResize=function(){var i=$(window).width();clearTimeout(e.sizeTimeout),e.sizeTimeout=setTimeout(function(){i=$(window).width(),e.filterOffsetPos=$("#content").offset().top},250),i<1100&&i>767?($("body").removeClass("mobile"),$("body").addClass("tablet no-transition")):i<768?($("body").removeClass("tablet"),$("body").addClass("mobile no-transition")):($("body").addClass("no-transition"),$("body").removeClass("tablet mobile")),setTimeout(function(){$("body").removeClass("no-transition")},100)},this.openPlayer=function(){var i=$('.card-item[data-id="'+GLOBALS.player+'"]'),t=i.offset().top-100,s=!1;$("body").addClass("filter-fixed"),$("body,html").animate({scrollTop:t},function(){clearTimeout(s),s=setTimeout(function(){i.addClass("expanded"),$(window).on("scroll.scrollWatch",e.scrollWatch)},100)})},this.changeSize=function(i,t){i.preventDefault();var s;e.old_size=e.size,e.size=t||$(this).data("size"),events.publish("size.update",{size:e.size}),s=e.old_size+"-to-"+e.size,$(".size-indicator").attr("class","size-indicator").addClass(e.size),$(".size-toggle .active").removeClass("active background-theme"),$(this).addClass("active background-theme"),$("body").removeClass("small medium large").addClass(e.size+" "+s)},this.scrollWatch=function(){$(window).scrollTop()>e.filterOffsetPos?$("body").addClass("filter-fixed"):$("body").removeClass("filter-fixed")},this.setColors=function(){var i=GLOBALS.theme_colors[e.sort_id];$("body").removeClass("ringer kevin danny jonathan az"),$("body").addClass(e.sort_id),$(".stroke").attr("style","stroke:"+i+";"),$(".arrow").attr("style","fill:"+i+";")},this.sort=function(i){i.preventDefault();$("body").addClass("rebuilding"),$(".active_filter").removeClass("active_filter"),$(i.currentTarget).addClass("active_filter"),e.sort_id=$(i.currentTarget).data("sort-id"),e.setColors(),e.buildList(GLOBALS.data.players),events.publish("sort.update",{})},this.filter=function(i){e.filter_id=$(i.currentTarget).data("filter"),$("#filters a.active, #mobile-nav .nav-filter a").removeClass("active color-theme"),$(i.currentTarget).addClass("active color-theme"),$(window).scrollTop()>e.filterOffsetPos&&$("body,html").animate({scrollTop:e.filterOffsetPos+1}),"all"===e.filter_id?e.$el.removeClass("filtered"):e.$el.addClass("filtered"),events.publish("filter.update",{filter:e.filter_id})},this.buildList=function(){var i=0;_.each(GLOBALS.list[e.sort_id],function(t,s){(t=_.findWhere(GLOBALS.data.players,{filter_id:t.filter_id}))&&e.cards[s]&&(i++,e.cards[s].update(t))}),setTimeout(function(){$("body").removeClass("rebuilding")},1e3)},this.init(),e}function Mobile(e){var i=this;return i.list=e,i.filterOffsetPos=$("#content").offset().top,i.init=function(){i.initEvents()},i.initEvents=function(){$("#mobile-nav").on("click",".toggle-zone",i.toggleMobileNav),$("#mobile-nav").on("click",".sort li",i.mobileSort),$("#mobile-nav").on("click",".nav-filter a",i.mobileFilter),$("#mobile-nav .nav-switcher").on("click","a",i.mobileChangeSize)},this.toggleMobileNav=function(){window.clearTimeout(i.navTimeout),$(window).scrollTop()<i.filterOffsetPos&&!$("#mobile-nav").hasClass("open")&&$("body,html").scrollTop(i.filterOffsetPos+1),$("#mobile-nav").toggleClass("open"),$("body").off("click.clickout"),i.navTimeout=setTimeout(function(){$("#mobile-nav").hasClass("open")&&$("body").on("click.clickout",function(e){$(e.target).hasClass("toggle-zone")||0!=$(e.target).parents("#mobile-nav").length||i.toggleMobileNav()})},500)},this.mobileChangeSize=function(e){e.preventDefault();var t=$(this).data("size");$("#mobile-nav").removeClass("open"),setTimeout(function(){$("#mobile-nav .nav-switcher a").removeClass("active color-theme"),$(e.target).addClass("active color-theme"),i.list.changeSize(e,t)},100)},i.mobileSort=function(e){e.preventDefault(),$("#mobile-nav").removeClass("open"),setTimeout(function(){$("#mobile-nav .sort li").removeClass("active color-theme"),$(e.target).addClass("active color-theme"),i.list.sort(e)},100)},i.mobileFilter=function(e){e.preventDefault(),setTimeout(function(){i.list.filter(e),$("#mobile-nav").removeClass("open")},100)},i.init(),i}var events=function(){var e={},i=e.hasOwnProperty;return{subscribe:function(t,s){i.call(e,t)||(e[t]=[]);var a=e[t].push(s)-1;return{remove:function(){delete e[t][a]}}},publish:function(t,s){i.call(e,t)&&e[t].forEach(function(e){e(void 0!=s?s:{})})}}}();$(document).ready(function(){var e=new CardList;new Mobile(e)}),function(){for(var e,i=function(){},t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],s=t.length,a=window.console=window.console||{};s--;)e=t[s],a[e]||(a[e]=i)}();